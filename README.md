# CS686 Lab 01

### Read the instructions carefully.

In case of errors/typos, corrections will be announced on Piazza and in class - please do check Piazza frequently.

## Do's and Don'ts

### Do's:
 - You can do whatever you want with the files under `java/dataflow` directory, including `build.gradle`.
 - For instance, if you find it useful to import some libraries, you can do that in `build.gradle`.
 - You can modify/add/remove any packages/files/classes/methods as you like.
 - You can (and should) add more unit tests (the more the better -- always consider 'corner cases').
 - Try to apply appropriate design patterns/principles (Effective Java by Joshua Bloch).
 - As long as `java/judge` builds correctly (after your changes to `java/dataflow`) you're fine.

### Don'ts:
 - Do NOT change anything outside `java/dataflow` directory (if you have to, ask first on Piazza; in most cases, it'd be either (a) you're doing something unexpected or (b) the starter code's lacking some files/etc. in which case I'll fix it so that you don't have to)
 - Specifically, `java/judge/*`,`java/settings.gradle`,`.github/workflows/*` should NOT be touched at all.
 - Do not add/remove/modify any other files than `*.java` (except for `java/dataflow/build.gradle`, if you must import some libraries).
 
### Bottom-line:
 - After you push your commit to git repo, check `https://github.com/cs-rocks/$your-repo-name/actions` to see if things "compile" and "build", at least.
 - After your commit is built on Github (even if it fails unit tests), you can download `reports` by clicking on `Artifacts` button.
 These zip files (see https://www.dropbox.com/s/7su4lv5f5y3mp3q/img01-git-artifacts.png?dl=0) contain `java/dataflow/build/*` and `java/judge/build/*`, generated by gradle wrapper. This may help you troubleshoot technical issues (however, you should be able to do the same on your local machine).
 - If in doubt, ask on Piazza.

## Code Style and Formatting

Your instructor uses `inetlliJ`, but it shouldn't really matter if you use `Eclipse`.

*However, vi/vim is better than emacs.*

### If you use inetlliJ
 - Install "Eclipse Code Formatter" plugin, and import the provided `eclipse-java.importorder` file and `eclipse-java-google-style.xml` file appropriately. 
 - Install "Save Actions" plugin, and enable these options (other options can be checked off/disabled): https://www.dropbox.com/s/5qgqkf8nh9y9gv7/Screenshot%202020-01-12%2010.01.48.png?dl=0

### If you use Eclipse
 - You can import `eclipse-java-google-style.xml` somehow (figure that out!).
 - Nothing to do for import order.
 
### About Commenting (be clear but concise!)
 - For every class/method, ask yourself, "should I add a short description of what this is for?" 
 - If something is quite trivial/straightforward, don't bother adding comments (assume that the readers of your code would be teaching staff & classmates).
 - If you find it too tedious to comment on a method/class (perhaps it's too complex or too long), then split it into smaller pieces (multiple methods or multiple interfaces/classes).
 - You do NOT need to JavaDoc everything -- that's just too much work for little benefit (at least in this course).
 - Unless you are doing something out of ordinary / black-magic stuff, you should only provide concise, high-level description of important classes/methods in your work.
 - For *some* methods/classes, the instructions may ask you to explain certain things in comments; in such cases, you should provide your answer/explanation very clearly. 
 - For Labs, don't worry about commenting/design patterns.
 - For Projects, you'll be given instructions regarding commenting/design patterns.
 
### Questions or problems? Ask on Piazza.
### If you don't follow these instructions, there may be a deduction.

## Dev Setup (Mac OS X; for Ubuntu, it should be similar, so figure it out and maybe share on Piazza)
 - Install `homebrew`, `sdkman`, `Java 8` (openJDK recommended), and `gradle 4.10.3`.
 - In particular, you'll find it easiest to install `gradle 4.10.3` (this specific version is required for this course to avoid techinical issues later) via `sdkman`.
 - See below for reference.
```
[~/Downloads/dataflow]$ java -version
java version "1.8.0_172"
Java(TM) SE Runtime Environment (build 1.8.0_172-b11)
Java HotSpot(TM) 64-Bit Server VM (build 25.172-b11, mixed mode)
[~/Downloads/dataflow]$ javac -version
javac 1.8.0_172
[~/Downloads/dataflow]$ gradle --version

------------------------------------------------------------
Gradle 4.10.3
------------------------------------------------------------

Build time:   2018-12-05 00:50:54 UTC
Revision:     e76905e3a1034e6f724566aeb985621347ff43bc

Kotlin DSL:   1.0-rc-6
Kotlin:       1.2.61
Groovy:       2.4.15
Ant:          Apache Ant(TM) version 1.9.11 compiled on March 23 2018
JVM:          1.8.0_172 (Oracle Corporation 25.172-b11)
OS:           Mac OS X 10.13.6 x86_64

[~/Downloads/dataflow]$ which gradle
/Users/haden/.sdkman/candidates/gradle/current/bin/gradle
[~/Downloads/dataflow]$
```

## Check the error messages after you run `gradle test` for the first time
 - Before you make any changes to the skeleton code, you should run gradle test and see if unit tests expectedly fail.
 - Run `$ gradle clean; gradle cleanTest test --continue` under your repo's `java/` dir.
 - If you installed gradle plugin for intelliJ or Eclipse, you can also run unit tests from your IDE.
 - However, the grading system will use gradle (in a docker container) to run tests and grade your code.
 - See below for reference (exact contents may be slightly different).

<details><summary>CLICK ME (to see test results, when run at the root of repo)</summary>
<p>

```
$ gradle clean; gradle cleanTest test --continue

BUILD SUCCESSFUL in 0s
2 actionable tasks: 1 executed, 1 up-to-date

> Task :dataflow:test FAILED

edu.usfca.dataflow.TestMain > testDummy FAILED
    java.lang.AssertionError: Values should be different. Actual:
        at org.junit.Assert.fail(Assert.java:88)
        at org.junit.Assert.failEquals(Assert.java:185)
        at org.junit.Assert.assertNotEquals(Assert.java:161)
        at org.junit.Assert.assertNotEquals(Assert.java:175)
        at edu.usfca.dataflow.TestMain.testDummy(TestMain.java:13)

2 tests completed, 1 failed

> Task :judge:test FAILED

edu.usfca.dataflow.__TestMain > testAnswers FAILED
    java.lang.AssertionError: Values should be different. Actual: 0
        at org.junit.Assert.fail(Assert.java:88)
        at org.junit.Assert.failEquals(Assert.java:185)
        at org.junit.Assert.assertNotEquals(Assert.java:199)
        at org.junit.Assert.assertNotEquals(Assert.java:211)
        at edu.usfca.dataflow.__TestMain.testAnswers(__TestMain.java:17)

edu.usfca.dataflow.__TestMain > testGetUserToken FAILED
    java.lang.AssertionError: Values should be different. Actual:
        at org.junit.Assert.fail(Assert.java:88)
        at org.junit.Assert.failEquals(Assert.java:185)
        at org.junit.Assert.assertNotEquals(Assert.java:161)
        at org.junit.Assert.assertNotEquals(Assert.java:175)
        at edu.usfca.dataflow.__TestMain.testGetUserToken(__TestMain.java:12)

edu.usfca.dataflow.utils.__TestProtoUtils > testGetJsonFromMessage FAILED
    org.junit.ComparisonFailure: expected:<{["os":"ANDROID","uuid":"be7a454e-dc38-438f-b574-df1f545980d7"]}> but was:<{[
      "os": "ANDROID",
      "uuid": "be7a454e-dc38-438f-b574-df1f545980d7"
    ]}>
        at org.junit.Assert.assertEquals(Assert.java:115)
        at org.junit.Assert.assertEquals(Assert.java:144)
        at edu.usfca.dataflow.utils.__TestProtoUtils.testGetJsonFromMessage(__TestProtoUtils.java:36)

edu.usfca.dataflow.utils.__TestProtoUtils > testGetSerializedSize FAILED
    java.lang.AssertionError: expected:<40> but was:<1600>
        at org.junit.Assert.fail(Assert.java:88)
        at org.junit.Assert.failNotEquals(Assert.java:834)
        at org.junit.Assert.assertEquals(Assert.java:645)
        at org.junit.Assert.assertEquals(Assert.java:631)
        at edu.usfca.dataflow.utils.__TestProtoUtils.testGetSerializedSize(__TestProtoUtils.java:19)

edu.usfca.dataflow.TestMain > testDummy FAILED
    java.lang.AssertionError: Values should be different. Actual:
        at org.junit.Assert.fail(Assert.java:88)
        at org.junit.Assert.failEquals(Assert.java:185)
        at org.junit.Assert.assertNotEquals(Assert.java:161)
        at org.junit.Assert.assertNotEquals(Assert.java:175)
        at edu.usfca.dataflow.TestMain.testDummy(TestMain.java:13)

6 tests completed, 5 failed

FAILURE: Build completed with 2 failures.

1: Task failed with an exception.
-----------
* What went wrong:
Execution failed for task ':dataflow:test'.
> There were failing tests. See the report at: file:///Users/haden/usf/cs686/lab01-starter/java/dataflow/build/reports/tests/test/index.html

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
==============================================================================

2: Task failed with an exception.
-----------
* What went wrong:
Execution failed for task ':judge:test'.
> There were failing tests. See the report at: file:///Users/haden/usf/cs686/lab01-starter/java/judge/build/reports/tests/test/index.html

* Try:
Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output. Run with --scan to get full insights.
==============================================================================

* Get more help at https://help.gradle.org

BUILD FAILED in 4s
15 actionable tasks: 12 executed, 3 up-to-date
```
</p>
</details>

## Short Answer Questions
 - In `Main` class under `edu.usfca.dataflow` package, you will find five methods named `getAnswerForQuestion#()` (where `#` goes from 1 to 5).
 - Fix those five methods to return correct answers. 
 - Q1 (`int`): Which version of Java will we use in this course?
 - Q2 (`int`): How many weekly labs will there be in this course? Check the course website to answer this.
 - Q3 (`int`): How many lectures will there be, according to the course website?
 - Q4 (`String`): On What days will course projects be due? One word.
 - Q5 (`String`): What's the first thing you should DO when you run into trouble while working on labs/projects? One word.
 - Note: For Q4 and Q5, the answers are case insensitive.

## Coding Assignment
 - In `ProtoUtils` class under `edu.usfca.dataflow.utils` package, there are two methods. 
 - These methods are partially correct, but they return incorrect values. Fix them (according to the comments & unit tests provided).
 
## Commits & Testing
 - **Make incremental changes and commit your changes often**.
 - One good habit is to make a commit every time you do any one of the following:
   1. After fixing some parts of code, your code now passes more unit tests (but don't wait until you fix everything... just commit often).
   2. After refactoring parts of your code or adding comments.
   3. If possible, try not to mix up 1 and 2 above in a single commit. It's often better to "make things work" (and commit) and then to "clean things up" (and commit again).
 - Test often. Run unit tests from IDE or via gradle on command-line.
 - Submit often. 
 - Fixed a broken method? Run unit tests locally, make a commit, and push (to get it graded).
 - Refactored something? Run unit tests locally, make a commit, and push (to get it graded).

## Grading
 - Number of sample/sharable/hidden tests: 4 / 5 / 10
 - If your submission fails any one of the sample tests: Your score will be 0.
 - Otherwise, your overall score will be 30% * sharable tests + 70% * hidden tests.
 - Your score for this assignment will be the maximum score you obtain before the deadline.
 - There is no hard limit on how often you can commit or how many times you can make submissions. However, if your submissions make the grading system's performance degrade and/or affect other students' experiences, you may be penalized for such disruptions. Furthermore, it may lead me to introducing submission quota per individual, so that you'll be given fewer submission opportunities for later labs/projects (which may be tricker than the first few).

## Final Check
 - This lab assignment is particularly and ridiculously easy.
 - The purpose is to set up dev env and IDEs, and to get yourself familiar with the grading system.
 - Therefore, once you get the score you want for this assignment, feel free to submit buggy code to see how the grading system works.
 - This does NOT mean that you should try to `hack` or `crack` the grading system (it's just a VM running on GCP that pulls your commits periodically and grade them). If you attempt to do so, your score for a lab/project will be an automatic 0 as that would disturb the entire class (it's a shared resource).
 
## Honor Code
 - **Do not ever share/show/post your code. That's an automatic F.**

## Questions?
 - Please ask on Piazza.
 - For technical issues, you are allowed to share any error messages or the like.
